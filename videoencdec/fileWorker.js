let initPromiseResolve;const initPromise=new Promise(e=>{initPromiseResolve=e});let lastWritePromise;self.onmessage=async function(e){const{type:s,data:t}=e.data;switch(s){case"init":{const s=await navigator.storage.getDirectory();try{await s.removeEntry(t.fileName)}catch(e){}const i=await s.getFileHandle(t.fileName,{create:!0});if(0!==(await i.getFile()).size)throw new Error("File is not empty");self.accessHandle=await i.createSyncAccessHandle(),self.writePosition=0,initPromiseResolve();break}case"write":{await initPromise;const{chunk:e,position:s}=t;lastWritePromise=self.accessHandle.write(e,{at:s}),self.writePosition=Math.max(self.writePosition,s+e.length);break}case"close":self.accessHandle&&(await lastWritePromise,await self.accessHandle.flush(),await self.accessHandle.close(),self.postMessage({type:"closed"}))}};